---

title: HephaestusModel


keywords: fastai
sidebar: home_sidebar

summary: "Encapsulates NMT operations on AbstractMethods."
description: "Encapsulates NMT operations on AbstractMethods."
nb_path: "nbs\05_HephaestusModel.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\05_HephaestusModel.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HephaestusModel" class="doc_header"><code>class</code> <code>HephaestusModel</code><a href="https://github.com/WM-SEMERU/hephaestus/tree/main/hephaestus/HephaestusModel.py#L25" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HephaestusModel</code>(<strong><code>modelDir</code></strong>:<code>str</code>)</p>
</blockquote>
<p>The <a href="/hephaestus/HephaestusModel.html"><code>HephaestusModel</code></a> is the means through which buggy AbstractMethods are translated into fixed ones. Each
<a href="/hephaestus/HephaestusModel.html"><code>HephaestusModel</code></a> occupies a directory which contains stored models, vocabularies, and configuration files.</p>
<p>Required args:</p>
<ul>
<li><code>modelDir</code>: The directory which stores files pertaining to the model. You can use a directory which already
contains the necessary files (previously generated from a different <a href="/hephaestus/HephaestusModel.html"><code>HephaestusModel</code></a>), in which case the
model will not have to be trained again. If you provide a directory that does not exist, the <code>HephaestsuModel</code>
will attempt to create it.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HephaestusModel.train" class="doc_header"><code>HephaestusModel.train</code><a href="https://github.com/WM-SEMERU/hephaestus/tree/main/hephaestus/HephaestusModel.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>HephaestusModel.train</code>(<strong><code>trainSource</code></strong>:<code>str</code>, <strong><code>trainTarget</code></strong>:<code>str</code>, <strong><code>validSource</code></strong>:<code>str</code>, <strong><code>validTarget</code></strong>:<code>str</code>, <strong><code>numCheckpoints</code></strong>:<code>int</code>=<em><code>10</code></em>, <strong><code>numGPUs</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>embeddingSize</code></strong>:<code>int</code>=<em><code>512</code></em>, <strong><code>rnnType</code></strong>:<code>str</code>=<em><code>'LSTM'</code></em>, <strong><code>rnnSize</code></strong>:<code>int</code>=<em><code>256</code></em>, <strong><code>numLayers</code></strong>:<code>int</code>=<em><code>2</code></em>, <strong><code>numTrainingSteps</code></strong>:<code>int</code>=<em><code>50000</code></em>, <strong><code>numValidations</code></strong>:<code>int</code>=<em><code>10</code></em>, <strong><code>dropout</code></strong>:<code>int</code>=<em><code>0.2</code></em>)</p>
</blockquote>
<p>Trains the model with the given parameters. Files containing AbstractMethods should have one per line with
tokens separated by spaces. 'source' files must contain AbstractMethods. 'target' files may contain
AbstractMethods or CompoundOperations in machine string format.</p>
<p>As the training progesses, checkpoint model files are created which follow the format <code>model_step_#.pt</code>, where
<code>#</code> corresponds to the training step number. Once training is complete, the finalized model is outputted to
<code>model_final.pt</code>. In addition, training command output is written to <code>train_output.txt</code>.</p>
<p>Default parameter values are such that they resemble the most successful NMT model in
<a href="https://arxiv.org/pdf/1812.08693.pdf">this paper</a> as closely as possible.</p>
<p>Parameters:</p>
<ul>
<li>Data and vocabulary:<ul>
<li><code>trainSource</code>: Required. File name containing training source data. Must be buggy AbstractMethods.</li>
<li><code>trainTarget</code>: Required. File name containing training target data. Can be either non-buggy
AbstractMethods or CompoundOperations in machine string format.</li>
<li><code>validSource</code>: Required. File name containing validation source data. Must be buggy AbstractMethods.</li>
<li><code>validTarget</code>: Required. File name containing validation target data. Must be the same type of data which
is contained in the file denoted by <code>trainTarget</code>.</li>
</ul>
</li>
<li>General options:<ul>
<li><code>numCheckpoints</code>: Number of times a checkpoint model is saved; e.g. if <code>numTrainingSteps</code> is 50,000 and
<code>numCheckpoints</code> is 10, then a checkpoint will be saved after every 5,000 training steps. Defaults to 10.</li>
<li><code>numGPUs</code>: Number of GPUs to use concurrently during training. If set to 0, then the CPU is used. Defaults
to 1.</li>
</ul>
</li>
<li>Model options:<ul>
<li><code>embeddingSize</code>: Word embedding size for source and target. Defaults to 512.</li>
</ul>
</li>
<li>Encoder/decoder options:<ul>
<li><code>rnnType</code>: Gate type to use in RNN encoder and decoder. Can be <code>"LSTM"</code> or <code>"GRU"</code>. Defaults to <code>"LSTM"</code>.</li>
<li><code>rnnSize</code>: Size of encoder and decoder RNN hidden states. Defaults to 256.</li>
<li><code>numLayers</code>: Number of layers each in the encoder and decoder. Defaults to 2.</li>
</ul>
</li>
<li>Learning options:<ul>
<li><code>numTrainingSteps</code>: Number of training steps to perform. Defaults to 50,000.</li>
<li><code>numValidations</code>: <code>validSteps</code>: Number of validations to perform during training; e.g. if <code>numTrainingSteps</code>
is 50,000 and <code>numValidations</code> is 10, then validation will occur after every 5,000 training steps. Defaults
to 10.</li>
<li><code>dropout</code>: Dropout probability. Defaults to 0.2.</li>
</ul>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HephaestusModel.getTrainingStats" class="doc_header"><code>HephaestusModel.getTrainingStats</code><a href="https://github.com/WM-SEMERU/hephaestus/tree/main/hephaestus/HephaestusModel.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>HephaestusModel.getTrainingStats</code>()</p>
</blockquote>
<p>Returns a pandas dataframe describing training statistics; the dataframe has the following columns:</p>
<ul>
<li><code>step</code>: The training step in increments of 50</li>
<li><code>trainAccuracy</code>: Model accuracy with respect to the <strong>training</strong> set</li>
<li><code>validAccuracy</code>: Validation accuracy. These values will likely not be present for every row.</li>
<li><code>crossEntropy</code>: Cross-entropy value</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HephaestusModel.translate" class="doc_header"><code>HephaestusModel.translate</code><a href="https://github.com/WM-SEMERU/hephaestus/tree/main/hephaestus/HephaestusModel.py#L188" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>HephaestusModel.translate</code>(<strong><code>buggy</code></strong>:<code>Union</code>[<code>str</code>, <a href="/hephaestus/AbstractMethod.html"><code>AbstractMethod</code></a>, <code>List</code>[<a href="/hephaestus/AbstractMethod.html"><code>AbstractMethod</code></a>]], <strong><code>modelFile</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>applyEditOperations</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Translates the given <code>buggy</code> AbstractMethods into supposedly fixed AbstractMethods, writes them to
<code>&lt;model_directory&gt;/postprocessed_output.txt</code>, and then returns them. The raw output of the model is written
to <code>&lt;model_directory&gt;/raw_output.txt</code> in case you want to access that as well. Depending on what type of
value is passed to <code>buggy</code>, the return value of this method changes according to the following:</p>
<table>
<thead><tr>
<th style="text-align:left"><code>buggy</code> type</th>
<th style="text-align:left">Return type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>str</code> (a file)</td>
<td style="text-align:left"><code>List[Optional[AbstractMethod]]</code></td>
</tr>
<tr>
<td style="text-align:left"><a href="/hephaestus/AbstractMethod.html"><code>AbstractMethod</code></a></td>
<td style="text-align:left"><code>Optional[AbstractMethod]</code></td>
</tr>
<tr>
<td style="text-align:left"><code>List[AbstractMethod]</code></td>
<td style="text-align:left"><code>List[Optional[AbstractMethod]]</code></td>
</tr>
</tbody>
</table>
<p>A <code>None</code> return value means that the model was unable to translate that abstract method correctly. This
could be due to the model outputting non well-formed CompoundOperations, among other things. These will
appear as blank lines in <code>postprocessed_output.txt</code>.</p>
<p>Optional args:</p>
<ul>
<li><code>modelFile</code>: A <code>.pt</code> file which is used for translation instead of the default <code>model_final.pt</code></li>
<li><code>applyEditOperations</code>: When set to True, the model output is interpreted as CompoundOperations and a
postprocessing stage occurs where the outputted CompoundOperations are applied to the inputted
AbstractMethods. When set to False, the raw output is interpreted as AbstractMethods and returned
without a postprocessing stage; in this case, the contents of <code>raw_output.txt</code> and
<code>postprocessed_output.txt</code> are identical. If the model was trained with EditOperations,
<code>applyEditOperations</code> should be True; if the model was trained with just AbstractMethods as in for
the control group, then this should be False. Defaults to True.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example-Usage">Example Usage<a class="anchor-link" href="#Example-Usage"> </a></h2><p>Let's create a small test model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">HephaestusModel</span><span class="p">(</span><span class="s2">&quot;test_model_loose&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now there is a directory called <code>test_model_loose</code> which will be populated with files once the model is trained. We will train the model with the loosely condensed edit operations dataset. Variables such as <a href="/hephaestus/DatasetConstruction.html#DATA_SMALL_METHODS_TRAIN_BUGGY"><code>DATA_SMALL_METHODS_TRAIN_BUGGY</code></a> describe the path to data files, and are defined in the <code>DatasetContstruction</code> module. Since this is just an example, a <em>very</em> small number of training steps will be used.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">DATA_SMALL_METHODS_TRAIN_BUGGY</span><span class="p">,</span>
    <span class="n">DATA_SMALL_OPS_LOOSE_TRAIN</span><span class="p">,</span>
    <span class="n">DATA_SMALL_METHODS_VALID_BUGGY</span><span class="p">,</span>
    <span class="n">DATA_SMALL_OPS_LOOSE_VALID</span><span class="p">,</span>
    <span class="n">numCheckpoints</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">numTrainingSteps</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">numValidations</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary data-open="Hide Output" data-close="Show Output"></summary>
        <summary></summary>
        
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[2021-04-23 00:41:58,835 INFO] Counter vocab from -1 samples.
[2021-04-23 00:41:58,835 INFO] n_sample=-1: Build vocab on full datasets.
[2021-04-23 00:41:58,839 INFO] corpus_1&#39;s transforms: TransformPipe()
[2021-04-23 00:41:58,839 INFO] Loading ParallelCorpus(../data/small/abstract_methods/train_buggy.txt, ../data/small/edit_ops/loose/train.txt, align=None)...
[2021-04-23 00:41:59,441 INFO] Counters src:429
[2021-04-23 00:41:59,441 INFO] Counters tgt:444
[2021-04-23 00:41:59,441 WARNING] path test_model_loose/save_data.vocab.src exists, may overwrite...
[2021-04-23 00:41:59,443 WARNING] path test_model_loose/save_data.vocab.tgt exists, may overwrite...
[2021-04-23 00:42:00,233 INFO] Parsed 2 corpora from -data.
[2021-04-23 00:42:00,233 INFO] Get special vocabs from Transforms: {&#39;src&#39;: set(), &#39;tgt&#39;: set()}.
[2021-04-23 00:42:00,233 INFO] Loading vocab from text file...
[2021-04-23 00:42:00,234 INFO] Loading src vocabulary from test_model_loose/save_data.vocab.src
[2021-04-23 00:42:00,235 INFO] Loaded src vocab has 429 tokens.
[2021-04-23 00:42:00,235 INFO] Loading tgt vocabulary from test_model_loose/save_data.vocab.tgt
[2021-04-23 00:42:00,237 INFO] Loaded tgt vocab has 444 tokens.
[2021-04-23 00:42:00,237 INFO] Building fields with vocab in counters...
[2021-04-23 00:42:00,238 INFO]  * tgt vocab size: 448.
[2021-04-23 00:42:00,238 INFO]  * src vocab size: 431.
[2021-04-23 00:42:00,238 INFO]  * src vocab size = 431
[2021-04-23 00:42:00,238 INFO]  * tgt vocab size = 448
[2021-04-23 00:42:00,239 INFO] Building model...
[2021-04-23 00:42:01,400 INFO] NMTModel(
  (encoder): RNNEncoder(
    (embeddings): Embeddings(
      (make_embedding): Sequential(
        (emb_luts): Elementwise(
          (0): Embedding(431, 512, padding_idx=1)
        )
      )
    )
    (rnn): LSTM(512, 256, num_layers=2, dropout=0.2)
  )
  (decoder): InputFeedRNNDecoder(
    (embeddings): Embeddings(
      (make_embedding): Sequential(
        (emb_luts): Elementwise(
          (0): Embedding(448, 512, padding_idx=1)
        )
      )
    )
    (dropout): Dropout(p=0.2, inplace=False)
    (rnn): StackedLSTM(
      (dropout): Dropout(p=0.2, inplace=False)
      (layers): ModuleList(
        (0): LSTMCell(768, 256)
        (1): LSTMCell(256, 256)
      )
    )
    (attn): GlobalAttention(
      (linear_context): Linear(in_features=256, out_features=256, bias=False)
      (linear_query): Linear(in_features=256, out_features=256, bias=True)
      (v): Linear(in_features=256, out_features=1, bias=False)
      (linear_out): Linear(in_features=512, out_features=256, bias=True)
    )
  )
  (generator): Sequential(
    (0): Linear(in_features=256, out_features=448, bias=True)
    (1): Cast()
    (2): LogSoftmax(dim=-1)
  )
)
[2021-04-23 00:42:01,400 INFO] encoder: 1535488
[2021-04-23 00:42:01,400 INFO] decoder: 2184384
[2021-04-23 00:42:01,400 INFO] * number of parameters: 3719872
[2021-04-23 00:42:01,401 INFO] Starting training on GPU: [0]
[2021-04-23 00:42:01,401 INFO] Start training loop and validate every 100 steps...
[2021-04-23 00:42:01,402 INFO] corpus_1&#39;s transforms: TransformPipe()
[2021-04-23 00:42:01,402 INFO] Loading ParallelCorpus(../data/small/abstract_methods/train_buggy.txt, ../data/small/edit_ops/loose/train.txt, align=None)...
[2021-04-23 00:42:11,086 INFO] Step 50/  500; acc:  19.02; ppl: 149.80; xent: 5.01; lr: 0.00010; 10499/4189 tok/s;     10 sec
[2021-04-23 00:42:20,980 INFO] Step 100/  500; acc:  25.66; ppl: 34.85; xent: 3.55; lr: 0.00010; 10178/4020 tok/s;     20 sec
[2021-04-23 00:42:20,981 INFO] valid&#39;s transforms: TransformPipe()
[2021-04-23 00:42:20,982 INFO] Loading ParallelCorpus(../data/small/abstract_methods/valid_buggy.txt, ../data/small/edit_ops/loose/valid.txt, align=None)...
[2021-04-23 00:42:28,903 INFO] Validation perplexity: 26.2731
[2021-04-23 00:42:28,903 INFO] Validation accuracy: 27.0358
[2021-04-23 00:42:28,906 INFO] Saving checkpoint test_model_loose/model_step_100.pt
[2021-04-23 00:42:39,452 INFO] Step 150/  500; acc:  28.72; ppl: 25.62; xent: 3.24; lr: 0.00010; 5513/2224 tok/s;     38 sec
[2021-04-23 00:42:48,512 INFO] Step 200/  500; acc:  39.35; ppl: 17.74; xent: 2.88; lr: 0.00010; 11036/4409 tok/s;     47 sec
[2021-04-23 00:42:48,513 INFO] Loading ParallelCorpus(../data/small/abstract_methods/valid_buggy.txt, ../data/small/edit_ops/loose/valid.txt, align=None)...
[2021-04-23 00:42:56,440 INFO] Validation perplexity: 12.6475
[2021-04-23 00:42:56,440 INFO] Validation accuracy: 45.342
[2021-04-23 00:42:56,442 INFO] Saving checkpoint test_model_loose/model_step_200.pt
[2021-04-23 00:43:06,535 INFO] Step 250/  500; acc:  45.08; ppl: 11.74; xent: 2.46; lr: 0.00010; 5684/2231 tok/s;     65 sec
[2021-04-23 00:43:15,860 INFO] Step 300/  500; acc:  45.63; ppl:  9.98; xent: 2.30; lr: 0.00010; 10778/4211 tok/s;     74 sec
[2021-04-23 00:43:15,862 INFO] Loading ParallelCorpus(../data/small/abstract_methods/valid_buggy.txt, ../data/small/edit_ops/loose/valid.txt, align=None)...
[2021-04-23 00:43:23,783 INFO] Validation perplexity: 9.10963
[2021-04-23 00:43:23,783 INFO] Validation accuracy: 46.1768
[2021-04-23 00:43:23,785 INFO] Saving checkpoint test_model_loose/model_step_300.pt
[2021-04-23 00:43:34,220 INFO] Step 350/  500; acc:  45.65; ppl:  9.50; xent: 2.25; lr: 0.00010; 5662/2199 tok/s;     93 sec
[2021-04-23 00:43:44,069 INFO] Step 400/  500; acc:  45.68; ppl:  9.27; xent: 2.23; lr: 0.00010; 10412/4126 tok/s;    103 sec
[2021-04-23 00:43:44,070 INFO] Loading ParallelCorpus(../data/small/abstract_methods/valid_buggy.txt, ../data/small/edit_ops/loose/valid.txt, align=None)...
[2021-04-23 00:43:51,990 INFO] Validation perplexity: 8.46225
[2021-04-23 00:43:51,990 INFO] Validation accuracy: 46.5759
[2021-04-23 00:43:51,992 INFO] Saving checkpoint test_model_loose/model_step_400.pt
[2021-04-23 00:44:02,389 INFO] Step 450/  500; acc:  45.98; ppl:  8.88; xent: 2.18; lr: 0.00010; 5523/2174 tok/s;    121 sec
[2021-04-23 00:44:12,108 INFO] Step 500/  500; acc:  46.08; ppl:  8.87; xent: 2.18; lr: 0.00010; 10587/4161 tok/s;    131 sec
[2021-04-23 00:44:12,109 INFO] Loading ParallelCorpus(../data/small/abstract_methods/valid_buggy.txt, ../data/small/edit_ops/loose/valid.txt, align=None)...
[2021-04-23 00:44:20,029 INFO] Validation perplexity: 8.1738
[2021-04-23 00:44:20,029 INFO] Validation accuracy: 47.3225
[2021-04-23 00:44:20,031 INFO] Saving checkpoint test_model_loose/model_step_500.pt
</pre>
</div>
</div>

</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we want to view information about the training process of the model without having to scroll through all the output above; we can use the <a href="/hephaestus/HephaestusModel.html#HephaestusModel.getTrainingStats"><code>HephaestusModel.getTrainingStats</code></a> method, which returns a Pandas DataFrame containing such information:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">getTrainingStats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>step</th>
      <th>trainAccuracy</th>
      <th>validAccuracy</th>
      <th>crossEntropy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>19.02</td>
      <td>NaN</td>
      <td>5.01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>100</td>
      <td>25.66</td>
      <td>27.0358</td>
      <td>3.55</td>
    </tr>
    <tr>
      <th>2</th>
      <td>150</td>
      <td>28.72</td>
      <td>NaN</td>
      <td>3.24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>200</td>
      <td>39.35</td>
      <td>45.3420</td>
      <td>2.88</td>
    </tr>
    <tr>
      <th>4</th>
      <td>250</td>
      <td>45.08</td>
      <td>NaN</td>
      <td>2.46</td>
    </tr>
    <tr>
      <th>5</th>
      <td>300</td>
      <td>45.63</td>
      <td>46.1768</td>
      <td>2.30</td>
    </tr>
    <tr>
      <th>6</th>
      <td>350</td>
      <td>45.65</td>
      <td>NaN</td>
      <td>2.25</td>
    </tr>
    <tr>
      <th>7</th>
      <td>400</td>
      <td>45.68</td>
      <td>46.5759</td>
      <td>2.23</td>
    </tr>
    <tr>
      <th>8</th>
      <td>450</td>
      <td>45.98</td>
      <td>NaN</td>
      <td>2.18</td>
    </tr>
    <tr>
      <th>9</th>
      <td>500</td>
      <td>46.08</td>
      <td>47.3225</td>
      <td>2.18</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that the model is trained, we can test it out. This gets the first buggy <a href="/hephaestus/AbstractMethod.html#AbstractMethod"><code>AbstractMethod</code></a> from the testing data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">buggyMethod</span> <span class="o">=</span> <span class="n">readAbstractMethodsFromFile</span><span class="p">(</span><span class="n">DATA_SMALL_METHODS_TEST_BUGGY</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">buggyMethod</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>private TYPE_1 getType ( TYPE_2 VAR_1 ) { TYPE_3 VAR_2 = new TYPE_3 ( STRING_1 ) ; return new TYPE_1 ( VAR_2 , VAR_2 ) ; }</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then translate the method into a supposedly fixed version using <a href="/hephaestus/HephaestusModel.html#HephaestusModel.translate"><code>HephaestusModel.translate</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputMethod</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">buggyMethod</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary data-open="Hide Output" data-close="Show Output"></summary>
        <summary></summary>
        
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[2021-04-23 00:45:21,047 INFO] Translating shard 0.
[2021-04-23 00:45:21,058 INFO] PRED AVG SCORE: -1.3559, PRED PPL: 3.8803
</pre>
</div>
</div>

</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There is a possibility that the model was unable to translate the buggy method correctly, e.g. if the model outputted ill-formed EditOperations that could not be parsed and applied to the buggy method. Therefore, we should check that the outputted method is not <code>None</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span><span class="p">(</span><span class="n">outputMethod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>View the contents of the outputted <a href="/hephaestus/AbstractMethod.html#AbstractMethod"><code>AbstractMethod</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputMethod</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>private TYPE_1 getType ( TYPE_2 VAR_1 ) { return new TYPE_1 ( VAR_2 , VAR_2 ) ; }</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can determine what exactly changed from the buggy method to the outputted method by getting the EditOperations between the two, then condensing them for easier readability.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">observedOperations</span> <span class="o">=</span> <span class="n">getCondensedLoose</span><span class="p">(</span><span class="n">buggyMethod</span><span class="o">.</span><span class="n">getEditOperationsTo</span><span class="p">(</span><span class="n">outputMethod</span><span class="p">))</span>
<span class="n">observedOperations</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[COMPOUND_DELETE 8:17]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So it seems that the changes were deletions on tokens in the index range 8:17. We can verify that these were the actual edit operations applied by the model by looking at <code>raw_output.txt</code> directly.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">appliedOperations</span> <span class="o">=</span> <span class="n">readCompoundOperationsFromFile</span><span class="p">(</span><span class="s2">&quot;test_model_loose/raw_output.txt&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">appliedOperations</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[COMPOUND_DELETE 8:17]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">appliedOperations</span> <span class="o">==</span> <span class="n">observedOperations</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nice! But what was the correct answer, and how far off were we?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actualFixedMethod</span> <span class="o">=</span> <span class="n">readAbstractMethodsFromFile</span><span class="p">(</span><span class="n">DATA_SMALL_METHODS_TEST_FIXED</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">actualFixedMethod</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>private TYPE_1 getType ( TYPE_2 VAR_1 ) { TYPE_3 VAR_2 = new TYPE_3 ( STRING_1 ) ; return new TYPE_1 ( VAR_2 , VAR_2 , this , VAR_1 ) ; }</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">modelDistance</span> <span class="o">=</span> <span class="n">outputMethod</span><span class="o">.</span><span class="n">getEditDistanceTo</span><span class="p">(</span><span class="n">actualFixedMethod</span><span class="p">)</span>
<span class="n">modelDistance</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>13</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actualDistance</span> <span class="o">=</span> <span class="n">buggyMethod</span><span class="o">.</span><span class="n">getEditDistanceTo</span><span class="p">(</span><span class="n">actualFixedMethod</span><span class="p">)</span>
<span class="n">actualDistance</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since <code>modelDistance</code> is higher than <code>actualDistance</code>, our outputted method is actually further away from the actual fixed method than the original buggy method is! Oof. But keep in mind that this is only demonstrating example usage and that the model was trained with a laughable number of steps.</p>

</div>
</div>
</div>
</div>
 

